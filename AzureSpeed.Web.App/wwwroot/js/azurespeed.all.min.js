var guid,utils;angular.module("azurespeed",["ui.bootstrap"]);var cdn=[{id:0,name:"cdn",storage:"cdn",geo:"CDN",region:"CDN",location:"CDN"}],dc=[{id:1,name:"eastasia",storage:"azspdeastasia",geo:"Asia-Pacific (APAC)",region:"East Asia",location:"Hong Kong"},{id:2,name:"southeastasia",storage:"azspdsoutheastasia",geo:"Asia-Pacific (APAC)",region:"Southeast Asia",location:"Singapore"},{id:3,name:"centralus",storage:"azspdcentralus",geo:"North America",region:"Central US",location:"Iowa"},{id:4,name:"eastus",storage:"azspdeastus",geo:"North America",region:"East US",location:"Virginia"},{id:5,name:"eastus2",storage:"azspdeastus2",geo:"North America",region:"East US 2",location:"Virginia"},{id:6,name:"westus",storage:"azspdwestus",geo:"North America",region:"West US",location:"California"},{id:7,name:"northcentralus",storage:"azspdnorthcentralus",geo:"North America",region:"North Central US",location:"Illinois"},{id:8,name:"southcentralus",storage:"azspdsouthcentralus",geo:"North America",region:"South Central US",location:"Texas"},{id:9,name:"northeurope",storage:"azspdnortheurope",geo:"Europe (EMEA)",region:"North Europe",location:"Ireland"},{id:10,name:"westeurope",storage:"azspdwesteurope",geo:"Europe (EMEA)",region:"West Europe",location:"Netherlands"},{id:11,name:"japanwest",storage:"azspdjapanwest",geo:"Asia-Pacific (APAC)",region:"Japan West",location:"Osaka Prefecture"},{id:12,name:"japaneast",storage:"azspdjapaneast",geo:"Asia-Pacific (APAC)",region:"Japan East",location:"Saitama Prefecture"},{id:13,name:"brazilsouth",storage:"azspdbrazilsouth",geo:"South America",region:"Brazil South",location:"Sao Paulo State"},{id:14,name:"australiaeast",storage:"azspdaustraliaeast",geo:"Australia",region:"Australia East",location:"New South Wales"},{id:15,name:"australiasoutheast",storage:"azspdaustraliasoutheast",geo:"Australia",region:"Australia Southeast",location:"Victoria"},{id:16,name:"southindia",storage:"azspdsouthindia",geo:"India",region:"South India",location:"Chennai"},{id:17,name:"centralindia",storage:"azspdcentralindia",geo:"India",region:"Central India",location:"Pune"},{id:18,name:"westindia",storage:"azspdwestindia",geo:"India",region:"West India",location:"Mumbai"},{id:19,name:"canadacentral",storage:"azspdcanadacentral",geo:"North America",region:"Canada Central",location:"Toronto"},{id:20,name:"canadaeast",storage:"azspdcanadaeast",geo:"North America",region:"Canada East",location:"Quebec City"},{id:21,name:"azspdwestcentralus",storage:"azspdwestcentralus",geo:"North America",region:"West Central US",location:"West Central US"},{id:22,name:"azspdwestus2",storage:"azspdwestus2",geo:"North America",region:"West US 2",location:"West US 2"},{id:23,name:"chinaeast",storage:"azspchinaeast",geo:"China",region:"China East",location:"Shanghai"},{id:24,name:"chinanorth",storage:"azspchinanorth",geo:"China",region:"China North",location:"Beijing"},],checkStatusDc=new Array(22);(function(){var f=$(".nav.navbar-top-links.navbar-right"),e=f.find(".menu-label"),n=f.find(".dropdown-extend"),o=n.find(".dropdown-extend-div"),s=n.find("input[type=button]"),i=n.find("input[type=checkbox][name=regAll]"),h=i.parent(),t=null,r,u;for(i[0].checked=!0,r=0;r<checkStatusDc.length;r++)checkStatusDc[r]=!0;h.click(function(){i[0].checked?$.each(t,function(){checkStatusDc[this.value-1]=this.checked=!0}):$.each(t,function(){checkStatusDc[this.value-1]=this.checked=!1})});e.click(function(){var r=!0;$.each(t,function(){this.checked=checkStatusDc[this.value-1];checkStatusDc[this.value-1]||(r=!1)});i[0].checked=r;n.show()});n.mouseleave(function(){var t=setTimeout(function(){u();document.removeEventListener("click",n)},2e3),n=function(){u();clearTimeout(t);document.removeEventListener("click",n)};document.addEventListener("click",n)});$.each(dc,function(){var r=$("<div><\/div>").appendTo(o),i=$("<label><\/label>").appendTo(r),u=$("<input type='checkbox' name='reg' value='"+this.id+"'/>").appendTo(i);$("<span> "+this.region+"<\/span>").appendTo(i);t=n.find("input[type=checkbox][name=reg]")});s.click(function(){$.each(t,function(){checkStatusDc[this.value-1]=this.checked});n.hide()});u=function(){$.each(t,function(){this.checked=checkStatusDc[this.value-1]});n.hide()}})();guid={newGuid:function(){var n=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()}};utils={getRegions:function(n){for(var i=dc.slice(0),t=dc.length-1;t>=0;t--)checkStatusDc[t]||i.splice(t,1);return n?i.concat(cdn):i},getGeoList:function(){var n=[];return $.each(utils.getRegions(),function(){this.geo.indexOf("CDN")==-1&&$.inArray(this.geo,n)==-1&&n.push(this.geo)}),n},getSize:function(n,t,i,r){var f,u,e;for(t||(t="B"),i||(i="Auto"),r&&(n+=r),f=["B","KB","MB","GB","TB","PB"],u=-1,u=0;u<f.length;u++)if(f[u].toLowerCase()==t.toLowerCase())break;for(e=n,i=i.toLowerCase();u<f.length;){if(unit=f[u],u++,i!="auto"&&unit.toLowerCase()==i)break;if(i=="auto"&&e<1024)break;e=e/1024}return unit=f[u-1],{value:Math.round(e*100)/100+" ",unit:unit}},getSizeStr:function(n,t,i,r){var u=this.getSize(n,t,i,r);return u?u.value+u.unit:null},convertSizeStrToFloat:function(n){for(var r=["KB","MB","GB","TB","PB","B"],i=-1,t=0,i=0;i<r.length;i++)if(n.toLowerCase().contains(r[i].toLowerCase())){t=n.toLowerCase().replace(r[i].toLowerCase(),"");break}switch(r[i].toLowerCase()){case"b":t=parseFloat(t);break;case"kb":t=parseFloat(t)*1024;break;case"mb":t=parseFloat(t)*1048576;break;case"gb":t=parseFloat(t)*1073741824;break;case"tb":t=parseFloat(t)*1099511627776;break;case"pb":t=parseFloat(t)*0x4000000000000}return t}};angular.module("azurespeed").controller("cloudRegionFinderCtrl",["$scope","$http",function(n,t){n.result="";n.ipOrUrl="";n.click=function(){n.result="Please wait";t.get("/api/region",{params:{ipOrUrl:n.ipOrUrl}}).success(function(t){n.result=t}).error(function(t){n.result=t})};n.canSearch=function(){if(/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(n.ipOrUrl))return!0;var t=new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i");return t.test(n.ipOrUrl)?!0:!1}}]);angular.module("azurespeed").controller("downloadCtrl",["$scope","$http",function(n,t){n.items=utils.getRegions();angular.forEach(n.items,function(n){var i={region:n.region,blobName:"100MB.bin",operation:"download"};t.get("/api/sas",{params:i}).success(function(t){console.log(t);n.url=t})})}]);angular.module("azurespeed").controller("latencyCtrl",["$scope","$http",function(){}]);angular.module("azurespeed").controller("ipRangeCtrl",["$scope","$http",function(n,t){t.get("/api/iprange",{}).success(function(t){n.subnetList=t})}]);angular.module("azurespeed").controller("uploadCtrl",["$scope","$http",function(n,t){n.results=[];n.regions=utils.getRegions();n.checkedRegions=[];n.message="test mess";n.upload=function(){if(n.checkedRegions.length!=0){var i={region:n.checkedRegions[0].region,blobName:guid.newGuid(),operation:"upload"};t.get("/api/sas",{params:i}).success(function(t){for(var i,r,u=[],f=262144,e=0;e<f;e++)u.push(".");i=n.checkedRegions[0].name;r=t;console.log(i);console.log(r);var s=ja.storage.blob(r),o=new Date,h=function(){o=new Date;n.current={geozone:n.checkedRegions[0].geozone,region:n.checkedRegions[0].region,location:n.checkedRegions[0].location,progressPercent:0};n.results.push(n.current)},c=function(t){n.current.progressPercent=(t.loaded/t.total*100).toFixed(0);console.log("progressPercent = "+n.current.progressPercent);n.$digest()},l=function(){var r=(new Date-o)/1e3,t=utils.getSizeStr(f/r)+"/s";console.log("speed = "+t);n.current.speed=t;n.results.last=n.current;n.$digest();console.log(i+" upload completed successfully, speed = "+t);n.checkedRegions.shift();n.upload()},a=function(n){console.log(i+" upload completed with error"+n)};s.upload(u,h,c,l,a)})}};n.uploadLoop=function(){n.upload()};n.regionChange=function(){n.checkedRegions=[];angular.forEach(n.regions,function(t){t.checked&&n.checkedRegions.push(t)})};n.canClick=function(){return n.checkedRegions.length>0}}]);angular.module("azurespeed").controller("uploadLargeFileCtrl",["$scope","$http",function(n,t){n.results=[];n.regions=utils.getRegions();n.blockSizes=[256,512,1024,4096];n.threads=[1,2,4,8,16];n.progressNow=0;n.progressPercent=0;n.selectedBlockSize=4096;n.selectedThread=4;n.upload=function(){var i=$("#file-input")[0].files[0],r=n.selectedRegion.region,u={region:r,blobName:guid.newGuid(),operation:"upload"};t.get("/api/sas",{params:u}).success(function(t){ja.storage.blockSize=n.selectedBlockSize*1024;ja.storage.maxThread=n.selectedThread;var r=t,u=ja.storage.blob(r),f=new Date,e=function(){n.fileName=i.name;n.fileSize=utils.getSizeStr(i.size);n.progressNow=0;n.progressPercent=0;n.$digest()},o=function(t){n.progressNow=t.loaded;n.progressPercent=(t.loaded/t.total*100).toFixed(0);console.log("loaded = "+t.loaded);console.log("total = "+t.total);console.log("progressPercent = "+n.progressPercent);n.$digest()},s=function(){var t=(new Date-f)/1e3;n.speed=utils.getSizeStr(i.size/t)+"/s";n.message="upload time = "+t+"s, speed = "+n.speed;n.$digest();n.results.push({fileName:n.fileName,fileSize:n.fileSize,region:n.selectedRegion.region,blockSize:n.selectedBlockSize,thread:n.selectedThread,speed:n.speed})},h=function(t){n.error=t};u.upload(i,e,o,s,h)})};n.canUpload=function(){return n.selectedRegion&&$("#file-input")[0].files.length>0}}]);